@model VisitorsSurvey.DLL.Entities.CustomPrepareForSave


<h1>Save</h1>

<style>

    .cell {
        flex: 1 0 2%;
        box-sizing: border-box;
        flex-direction: column;
        justify-content: center; 
        align-items: center;
        padding: 4px;
        text-align: center;
    }
    label{
        padding:2px 10px 2px 10px ; 
        background-color:green;
        color:#eee;
        padding: 2px 10px;
        background-color: green;
        color: #eee;
        font-size:larger; 
        font-weight:bolder; 
        border-radius: 5px;
        box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3);
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3); 
        background: linear-gradient(to bottom, #5cb85c, #3e8e3e); 
        border: 1px solid #2e7d32;
    }

    select {
        padding: 5px 10px;
        border-radius: 5px;
        border: 1px solid #2e7d32;
        box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3);
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        outline: none;
    }

    select::after {
        content: '';
        position: absolute;
        right: 15px; 
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 7px solid #fff; 
        pointer-events: none;
        }

    .upside-down-text {
        transform: rotate(270deg);

        width: 52px;
        height: 34%;
        display: inline-block;
        margin-left: 20px;
        color: #eee;
        text-align: center;
        border: 1px solid #2e7d32;
        background-color: green;
        box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3);
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        background: linear-gradient(to bottom, #5cb85c, #3e8e3e);
    }

    .bordered-div {
        margin-top:20px;
        position: relative; 
        border: 1px solid black;
    }

        .bordered-div::before {
            content: " نموذج الاستبيان للزائر "; 
            position: absolute;
            top: -20px;
            left: 50%; 
            transform: translateX(-50%);
            background-color: white;
            padding: 0 5px;
            border: 1px solid black; 
            border-radius: 3px;
        }

    .large-checkbox {
        width: 10px;
        height: 10px;
        transform: scale(1.8);
        margin: 5px; 
    }

    textarea::placeholder {
        color: #ccc;
        text-decoration: dotted; 
    }
</style>
 <div>
     
    @using(Html.BeginForm("SaveForm", "Form", FormMethod.Post))
    {
    <div class="col-sm-12">
        <div class="row">

            <div class="col-sm-4">
                <label>
                    المنطقة
                </label>
                <select id="RegionDropdown">
                    <option value=""></option>
                </select>
            </div>
           
            <div class="col-sm-4">
                <label>
                    المدينة
                </label>
                <select id="CityDropdown">
                    <option value=""></option>
                </select>
            </div>
                <div class=" col-sm-4">
                    <label>
                        المحافظة
                    </label>
                    <select id="GovernateDropdown">
                        <option value=""></option>
                    </select>
                </div>

        </div>
    </div>
    <br />
        <div class="col-sm-12"> </div>
    <div class="col-sm-12">
        <div class="row">

          
            <div class=" col-sm-4">
                <label>
                    المنتزة
                </label>
                <select id="ParkDropdown">
                    <option value=""></option>
                </select>
            </div>
        </div>
    </div>
    <br />
        <div class=" row col-sm-12 " style=" border:1px solid black ; border-radius:3px; margin: 0; padding: 0;">
            <div class="col-sm-1" style="padding-left: 0; padding-right: 0;">
                    <div class="upside-down-text"> اليوم</div>
                    <div class="upside-down-text"> التاريخ</div>
                    <div class="upside-down-text"> الشهر</div>
        </div>
        <div class="col-sm-11" >
                    <div class=" row">
                        @foreach (var item in @Model.WeekDays)
                        {

                            <div class="col-sm-1 text-center">
                                @item.ArabicName
                                <br />
                            <input type="checkbox" class="large-checkbox" name="SelectedWeekDays" na value="@item.WeekDayCode" onclick="handleCheckboxClick(this,'SelectedWeekDays')">
                            </div>
                        }

                    </div>
                    <div class="row">
                        @foreach (var item in @Model.MonthDays)
                        {
                            <div class="cell text-center">

                                @item
                                <br />
                            <input type="checkbox" name="SelectedMonthDays" class="large-checkbox" value="@item" onclick="handleCheckboxClick(this,'SelectedMonthDays')">
                            </div>

                        }
                    </div>
                <div class="col-sm-12 row">
                        <div class="col-sm-10 row" >
                        @foreach (var item in @Model.YearMonths)
                        {
                            <div class="col-sm-1 text-center">

                                @item.ArabicName
                                <br />
                                <input type="checkbox" name="SelectedYearMonths" class="large-checkbox" value="@item.YearMonthCode" onclick="handleCheckboxClick(this,'SelectedYearMonths')">
                            </div>
                        }
                        </div>
                      
                    <div class="col-sm-2 text-center align-self-center">
                        عام @Model.Year
                    </div>
                </div>

        </div>
    </div>
    <br /> 
    <div></div>
    <div class="row col-sm-12">
        <div class="col-sm-9">
                <div class="bordered-div">

                    <div style="position:absolute;top: 49px;right: -48px; transform: rotate(270deg); padding:5px 50px;color:white;font-size:large; background-color:#2e7d32">
                        الزائر
                    </div>
                    <div class="col-sm-12 row">
                        <div class="col-sm-1"></div>
                        <div class="col-sm-11">

                            <table style="border-spacing: 0 20px;" class="table table-borderless">
                                <thead>
                                    <tr>
                                        <th></th>
                                        @foreach (var item in Model.Rates)
                                        {
                                            <th>  @item.ArabicName<br /> @item.Name</th>
                                        }
                                    </tr>
                                </thead>
                                @foreach (var item in Model.VisitorReviewItems)
                                {
                                    <tr>
                                        <td style=" ">
                                            <h4 style="background-color:blue;color:#eee ; text-align:center; font-size:larger ;padding:4px 10px;"> 
                                                @item.ArabicName 
                                                </h4>
                                            </td>
                                        @foreach (var itemRate in Model.Rates)
                                        {
                                            <td style=" text-align: center;">
                                                <input type="checkbox" class="large-checkbox" name="Rate" value="@(item.VisitorReviewItemCode+ "_" +itemRate.RateCode )" onclick="handleCheckboxClickReviewItem(this, '@item.VisitorReviewItemCode')" />
                                            </td>
                                        }
                                    </tr>
                                }
                            </table>
                        </div>
                    </div>
                </div>
        </div>
           
        <div class="col-sm-3">
            <div class="col-sm-6" style="background-color:green"> الشكاوى والمقترحات </div>
            <textarea class="form-control" id="exampleFormControlTextarea" rows="20"></textarea>
        </div>
    </div>

        <button type="button" onclick="Save()" class="btn btn-primary">Save</button>
}
 </div>
 


<script>
    $(document).ready(function () {

        $.ajax({
            url: '@Url.Action("GetList", "City")',
            type: 'GET',
            success: function (data) {
                var dropdown = $('#CityDropdown');
                $.each(data, function (index, item) {
                    dropdown.append($('<option/>', {
                        value: item.cityCode,
                        text: item.arabicName
                    }));
                });
            }
        });

        $.ajax({
            url: '@Url.Action("GetList", "Governate")',
            type: 'GET',
            success: function (data) {
                var dropdown = $('#GovernateDropdown');
                $.each(data, function (index, item) {
                    dropdown.append($('<option/>', {
                        value: item.governateCode,
                        text: item.arabicName

                    }));
                });
            }
        });

        $.ajax({
            url: '@Url.Action("GetList", "Region")',
            type: 'GET',
            success: function (data) {
                var dropdown = $('#RegionDropdown');
                $.each(data, function (index, item) {
                    dropdown.append($('<option/>', {
                        value: item.regionCode,
                        text: item.arabicName
                    }));
                });
            }
        }); $.ajax({
            url: '@Url.Action("GetList", "Park")',
            type: 'GET',
            success: function (data) {
                var dropdown = $('#ParkDropdown');
                $.each(data, function (index, item) {
                    dropdown.append($('<option/>', {
                        value: item.parkCode,
                        text: item.arabicName
                    }));
                });
            }
        });
    });
    function Save() {
        var textAreaValue = $('#exampleFormControlTextarea').val();
        var WeekDayChecked = parseInt($('input[name="SelectedWeekDays"]:checked').val(), 10);
        var MonthDayChecked = parseInt($('input[name="SelectedMonthDays"]:checked').val(), 10);
        var YearMonthChecked = parseInt($('input[name="SelectedYearMonths"]:checked').val(), 10);

        if (isNaN(WeekDayChecked) || isNaN(MonthDayChecked) || isNaN(YearMonthChecked)) {
            alert(' أختيار اليوم والشهر أجبارى');
            return false;
        } 
        if (isNaN(parseInt($('#RegionDropdown').val(), 10))
            || isNaN(parseInt($('#CityDropdown').val(), 10))
            || isNaN(parseInt($('#ParkDropdown').val(), 10))
            || isNaN(parseInt($('#GovernateDropdown').val(), 10))) {
            alert('أختيار المنطقة و المدينة والمحافظة والمنتزة أجبارى');
            return false;
        } 
        var data = {
            RegionCode: parseInt( $('#RegionDropdown').val(),10),
            CityCode: parseInt($('#CityDropdown').val(),10),
            GovernateCode: parseInt($('#GovernateDropdown').val(),10),
            ParkCode: parseInt($('#ParkDropdown').val(),10),
            WeekDayCode: WeekDayChecked,
            MonthDayCode: MonthDayChecked,
            YearMonthCode: YearMonthChecked,
            Notes: textAreaValue, 
            SelectedRates: [] 
        };
        $('input[name="Rate"]:checked').each(function () {
            var value = $(this).val();
            var parts = value.split('_'); 
            var VisitorReviewItemCode = parseInt(parts[0], 10); 
            var rateCode = parseInt(parts[1], 10);
            data.SelectedRates.push({
                VisitorReviewItemCode: VisitorReviewItemCode,
                RateCode: rateCode
            });
        });
        debugger;
        $.ajax({
            url: '@Url.Action("SavePost", "VisitorReviews")',
            type: 'POST',
            contentType: 'application/json', 
            data: JSON.stringify(data), 
            success: function (response) {
                alert('Data saved successfully!');
            },
            error: function (xhr, status, error) {
                alert('Error saving data: ' + error);
            }
        });
    }

    function handleCheckboxClick(checkbox,section) {
        if (checkbox.checked) {
            const checkboxes = document.getElementsByName(section);
            checkboxes.forEach((cb) => {
                if (cb !== checkbox) {
                    cb.checked = false; 
                }
            });
        }
    } function handleCheckboxClickReviewItem (checkbox, visitorReviewItemCode) {
        if (checkbox.checked) {
            const checkboxes = document.getElementsByName('Rate');
            checkboxes.forEach((cb) => {
                if (cb !== checkbox && cb.value.startsWith(visitorReviewItemCode)) {
                    cb.checked = false; 
                }
            });
        }
    }
</script>
</html>


